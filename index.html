<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>tetris.js</title>
  <script src="js/jquery-1.10.2.min.js"></script>
  <script src="js/jquery.timer.js"></script>

  <style type="text/css">
    div#hidden {
      display: none;
    }

    table#game_area {
      border: 1px solid black;
      margin: 50px auto;
    }

    table#game_area tr {}

    table#game_area tr td {
      height: 20px;
      width: 20px;
    }

  </style>
</head>
<body>

  <script>
    var AREA_WIDTH = 12;
    var AREA_HEIGHT = 24;
    var PIECE_COLOR = 'green';

    function GameTable(height, width) {
      this.height = height;
      this.width = width;
      this.pieces = new Array();

      this.table = $(document.createElement('table')).attr('id', 'game_area');

      for (var i = 0; i < height; i++) {
        var new_row = $(document.createElement('tr')).attr('class', i);

        for (var j = 0; j < width; j++) {
          $(new_row).append($(document.createElement('td')).attr('class', j));
        }

        $(this.table).append(new_row);
      }

      return this;
    }

    function Square(row, column) {
      this.row = row;
      this.column = column;
      return this;
    }

    GameTable.prototype.drawSquare = function(piece) {
      $('tr.' + piece.row + ' td.' + piece.column).css('background-color', PIECE_COLOR);
    }

    GameTable.prototype.drawPieces = function() {
      gt = this;
      this.pieces.forEach(function(p) {
        gt.drawSquare(p);
      });
    }

    GameTable.prototype.addPiece = function(row, column) {
      this.pieces.push(new Square(row, column));
    }

    GameTable.prototype.movePieceDown = function(piece) {
      $('tr.' + piece.row + ' td.' + piece.column).css('background-color', 'white');
      piece.row += 1;
      $('tr.' + piece.row + ' td.' + piece.column).css('background-color', PIECE_COLOR);
    }

    $(document).ready(function() {
      var gt = new GameTable(AREA_HEIGHT, AREA_WIDTH);

      $('body').append(gt.table);
      gt.addPiece(6,4);
      gt.drawPieces();
      
      var timer = $.timer(function() {
        gt.pieces.forEach(function(p) {
          gt.movePieceDown(p);
        });
      });

      timer.set({ time : 1000, autostart : true });
    });

  </script>

</body>
</html>
